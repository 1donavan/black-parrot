### Project Topic:
Make BlackParrot work with varying L1 i-cache sizes and associativities, including 32 KB/8-way, 16KB/4-way, 8KB/2-way, and 4KB/1-way.


### Team Member:
Donavan Erickson, Songchun Li

### [Original Schematic](https://github.com/1donavan/black-parrot/blob/uw_ee477_pparrot_wi20_team17_icache_flex/original_schematic.png)
### [Modified Schematic](https://docs.google.com/presentation/d/1C-lwMavq2Syx056gt9S1qsv7O720ZWNAwB7qxBnxAG8/edit?usp=sharing)
### [Notebook file](https://docs.google.com/document/d/1hBEbsP5agSm_wvsxSzwGFQzPGjlrEQ4TP4_kOTz1VAI/edit?usp=sharing)


Defined a new set of parameters in the top level aviary called icache_lce_sets and icache_lce_assoc. To use them in any file then you need to just put in the param  icache_lce_sets or icache_lce_assoc. I have already defined these in the icache file (The origional one not the icache_v2 one), the fe_mem file, and bp_fe_top.

To make the i-cache working well in different way associativitiy with still receiving 512 bits packet from CCE, a struct called bp_fe_vaddr_s in /bp_fe/src/include/bp_fe_mem_defines.vh is redifined. (The bit-width of offset is modified.)

Used a counter to stall extra cycles and add a buffer to keep the data/tag data for extra cycle so that 512 bits data can be written into different way set associative correctly.

And the benefit for this scheme is only 8/icache_assoc_way more cycles will be added for each instruction load.

#### Phase III
**Before Change PPA (32kB/ 8-way)**

| PROG      | mIPC | Core Power| I-cache Power|
| --------- | -----:|-----:| -----:|
| bs  | 355 |  4.82e+04uW|  1.37e+04 uW|
| fibcall     | 433| 5.26e+04uW |  1.37e+04 uW|
| median      | 410 | 5.54e+04uW |  1.90e+04uW|
| rv64ui-p-bit      |  287 | 4.55e+04uW |  1.30e+04uW|
| towers      |746 | 5.87e+04uW |  1.92e+04uW|
| vvadd      | 738 | 5.41e+04uW |  1.63e+04uW|
| dijkstra      | 752 | / |  /|
| frac      | 665 | / |  /|
| sglib-arraybinsearch  | 557 | / |  /|

|    Cell   | Area |
| --------- | -----:|
| core  | 2407973.5092 um<sup>2</sup> |
| i-icahe  | 919890.6531 um<sup>2 </sup>|

**After Change PPA
16kB/ 4-way**

| PROG      | mIPC |Power|I-cache Power|
| --------- | -----:|-----:| -----:|
| bs  | 350 |  1.63e+04uW|  8.86e+03 uW|
| fibcall     | 430| 4.67e+04uW |  1.01e+04uW|
| median      | 410 | 4.81e+04uW |  1.17e+04uW|
| rv64ui-p-bit      |  282 | 4.07e+04uW |  8.47e+03uW|
| towers      |745 | 5.12e+04uW |  1.16e+04uW|
| vvadd      | 737 | 4.79e+04uW |  9.97e+03uW|
| dijkstra      | 752 | / |  /|
| frac      | 665 | / |  /|
| sglib-arraybinsearch  | 557 | / |  /|

|    Cell   | Area |
| --------- | -----:|
| core  | 2004106.4670 um<sup>2</sup> |
| i-icahe  | 513597.0382 um<sup>2 </sup>|

**8kB/ 2-way**

| PROG      | mIPC |Core Power|I-cache Power|
| --------- | -----:|-----:|-----:|
| bs  | 342 |  3.91e+04uW|  5.66e+03uW|
| fibcall     | 425| 4.24e+04uW |  6.32e+03uW|
| median      | 409 | 4.35e+04uW |  7.23e+03uW|
| rv64ui-p-bit      |  272 | 3.71e+04uW |  5.35e+03uW|
| towers      |742 | 4.62e+04uW |  7.12e+03uW|
| vvadd      | 735 | 4.40e+04uW |  6.36e+03uW|
| dijkstra      | 752 | / |  /|
| frac      | 665 | / |  /|
| sglib-arraybinsearch  | 556 | / |  /|

|    Cell   | Area |
| --------- | -----:|
| core  | 1785994.8741 um<sup>2</sup> |
| i-icahe  | 295979.4229 um<sup>2 </sup>|

In summary, changing the i-cache configuration from 8-way to 4-way or 2-way will receive significant benefits in both power and area, and these benefits come with only a 5% performance loss. Making the black-parrot support not only 32kB/ 8-way set associativity i-cache but also 16kB/ 4-way and 8kB/ 2-way set associativity i-cache brings great benefits to those end users who are sensitive to power and area and not running heavy loading task on CPU.

#### Phase IV
The experiment result in Phase III is satisfactory, so it is not necessary to run another iteration. After running the 4-way and 2-way associative code through the backend we found that there were timing violations that occurred in icc and ptsi. We then ran the baseline test to compare against these values to see if we introduced these timing violations into the code or if the code had these from the start. We learned that the timing violations were in the baseline code as well so we spoke to the instructor and TAâ€™s and sent them all of our data. Waiting fixed till March 18th
